# Last Modified: Mon Nov 13 15:13:26 2017
#include <tunables/global>

/usr/bin/inbm-dispatcher {
  #include <abstractions/base>
  #include <abstractions/bash>
  #include <abstractions/nameservice>
  #include <abstractions/python>

  capability chown,
  capability dac_override,
  capability fsetid,
  capability mac_admin,
  capability sys_ptrace,
  /bin/cat Pix,
  /usr/bin/cat Pix,
  /bin/chmod rix,
  /usr/bin/chmod rix,
  /bin/cp rix,
  /usr/bin/cp rix,
  /bin/grep rix,
  /usr/bin/grep rix,
  /bin/gzip rix,
  /bin/mkdir rix,
  /bin/mv rix,
  /usr/bin/mv rix,
  /bin/systemctl rUx,
  /usr/bin/systemctl rUx,
  /bin/tar rix,
  /bin/gzip rix,
  /bin/lsb_release rUx,
  /usr/bin/lsb_release rUx,
  /usr/bin/tar rix,
  /usr/bin/gzip rix,
  /bin/uname rix,
  /usr/bin/uname rix,
  /bin/rm rix,
  /usr/bin/rm rix,
  /bin/ps rix,
  /usr/bin/ps rix,
  /boot/efi/ rw,
  /boot/efi/** rw,
  /dev/mem r,
  /dev/tty rw,
  /etc/ r,
  /etc/dpkg/dpkg.cfg r,
  /etc/dpkg/dpkg.cfg.d/ r,
  /etc/dpkg/dpkg.cfg.d/* r,
  /etc/intel_manageability.conf wr,
  /etc/firmware_tool_info.conf r,
  /etc/intel-manageability/public/dispatcher-agent/dispatcher-agent.crt r,
  /etc/intel-manageability/public/dispatcher-agent/ota_signature_cert.pem r,
  /etc/intel-manageability/public/mqtt-ca/mqtt-ca.crt r,
  /etc/intel-manageability/secret/dispatcher-agent/** r,
  /etc/opt/csl/csl-node/csl-manager r,
  /etc/opt/csl/csl-node/long-lived-token r,
  /etc/apt/sources.list rw,
  /etc/apt/sources.list.bak rw,
  /etc/dispatcher_state rw,
  /etc/lsb-release r,
  /etc/magic r,
  /etc/mime.types r,
  /etc/tc_config.conf r,
  /etc/trtl.conf wr,
  /etc/ssl/certs/csl-ca-cert.pem r,
  /etc/ssl/certs/csl-ca-cert.crt r,
  /lib/systemd/system/ r,
  /lib/systemd/system/configuration.service rw,
  /lib/systemd/system/diagnostic.service rw,
  /lib/systemd/system/inbm-dispatcher.service rw,
  /lib/systemd/system/cloudadapter.service rw,
  /lib/systemd/system/telemetry.service rw,
  /lib/systemd/system/trtl.service rw,
  /etc/task_list.yaml r,
  /etc/trtl.conf w,
  /opt/afulnx/afulnx_64 rUx,
  /usr/bin/afulnx_64 rUx,
  /proc/1/comm r,
  /proc/device-tree/firmware/bios/** r,
  /proc/*/mounts r,
  /proc/*/fd/ r,
  /proc/*/status r,
  /proc/sys/net/core/somaxconn r,
  /proc/sys/kernel/hostname r,
  /proc/sys/kernel/osrelease r,
  /run/docker.sock rw,
  /sbin/apparmor_parser rix,
  /sbin/ldconfig rix,
  /sbin/ldconfig.real rix,
  /sys/block/ r,
  /sys/class/hwmon/ r,
  /sys/devices/** r,
  /sys/firmware/dmi/tables/DMI r,
  /sys/firmware/dmi/tables/smbios_entry_point r,
  /sys/firmware/efi/systab r,
  /sys/firmware/efi/efivars/** w,
  /sys/kernel/security/apparmor/ r,
  /sys/kernel/security/apparmor/* w,
  /sys/kernel/security/apparmor/features/ r,
  /sys/kernel/security/apparmor/features/** r,
  /tmp/ rw,
  /tmp/** mrw,
  /usr/bin/apt-get rUx,
  /usr/bin/mkdir rix,
  /usr/bin/do-release-upgrade rUx,
  /usr/bin/docker-compose rUx,
  /usr/bin/dpkg rUx,
  /usr/bin/dpkg-deb rUx,
  /usr/bin/dpkg-query rUx,
  /usr/bin/dpkg-split rUx,
  /usr/bin/pip rUx,
  /usr/bin/python2.7 ix,
  /usr/bin/sudo rix,
  /usr/bin/trtl wPix,
  /usr/bin/trtl.dpkg-new rw,
  /usr/bin/unrar rix,
  /usr/bin/unrar-nonfree rix,
  /usr/bin/UpdateBIOS.sh rix,
  /usr/bin/configuration/ w,
  /usr/bin/configuration/** w,
  /usr/bin/configuration/configuration l,
  /usr/bin/diagnostic/ w,
  /usr/bin/diagnostic/** w,
  /usr/bin/diagnostic/diagnostic l,
  /usr/bin/inbm-dispatcher rix,
  /usr/bin/cloudadapter/ w,
  /usr/bin/cloudadapter/** w,
  /usr/bin/cloudadapter/cloudadapter l,
  /usr/bin/telemetry/ w,
  /usr/bin/telemetry/** w,
  /usr/bin/telemetry/telemetry l,
  /usr/bin/trtl/ w,
  /usr/bin/trtl/** w,
  /usr/bin/trtl.dpkg-new/ w,
  /var/intel-manageability/ rw,
  /var/intel-manageability/** rw,
  /usr/lib{,32,64}/python{2.[4-7],3.[0-5]}/**.{pyc,so} mrw,
  /usr/local/bin/docker-compose rix,
  /usr/local/lib/python2.7/dist-packages/.libs_cffi_backend/*.so{,.[0-9]*} mr,
  /usr/local/lib/python2.7/dist-packages/jsonschema/schemas/* r,
  /usr/local/lib/python2.7/dist-packages/certifi/* r,
  /usr/sbin/aa-status rix,
  /usr/share/configuration-agent/ w,
  /usr/share/configuration-agent/* rw,
  /usr/share/configuration-agent/inb_config_schema.xsd l,
  /usr/share/configuration-agent/inb_config_schema.xsd.dpkg-tmp l,
  /usr/share/configuration-agent/iotg_inb_schema.xsd l,
  /usr/share/configuration-agent/iotg_inb_schema.xsd.dpkg-tmp l,
  /usr/share/diagnostic-agent/ w,
  /usr/share/telemetry-agent/ w,
  /usr/share/dispatcher-agent/*.json r,
  /usr/share/dispatcher-agent/manifest_schema.xsd r,
  /usr/share/dispatcher-agent/firmware_tool_config_schema.xsd r,
  /usr/share/intel-manageability/** r,
  /usr/share/intel-manageability/* r,
  /usr/share/doc/configuration-agent/ w,
  /usr/share/doc/configuration-agent/* rw,
  /usr/share/doc/configuration-agent/* l,
  /usr/share/doc/diagnostic-agent/ w,
  /usr/share/doc/diagnostic-agent/* rw,
  /usr/share/doc/diagnostic-agent/* l,
  /usr/share/doc/dispatcher-agent/ w,
  /usr/share/doc/dispatcher-agent/* rw,
  /usr/share/doc/cloudadapter-agent/ w,
  /usr/share/doc/cloudadapter-agent/* rw,
  /usr/share/doc/cloudadapter-agent/* l,
  /usr/share/doc/telemetry-agent/ w,
  /usr/share/doc/telemetry-agent/* rw,
  /usr/share/doc/telemetry-agent/* l,
  /usr/share/doc/trtl/ w,
  /usr/share/doc/trtl/* rw,
  /usr/share/doc/trtl.dpkg-new/ rw,
  /usr/share/cloudadapter-agent/ w,
  /usr/share/trtl/trtl.xsd r,
  /usr/share/trtl/ w,
  /usr/share/trtl/* rw,
  /var/cache/manageability/ rw,
  /var/cache/manageability/** rw,
  /etc/intel-manageability/public/configuration-agent/ w,
  /etc/intel-manageability/public/configuration-agent/* l,
  /etc/intel-manageability/public/configuration-agent/* rw,
  /etc/intel-manageability/public/configuration-agent.dpkg-new/ wr,
  /etc/intel-manageability/public/diagnostic-agent/ w,
  /etc/intel-manageability/public/diagnostic-agent/* l,
  /etc/intel-manageability/public/diagnostic-agent/* rw,
  /etc/intel-manageability/public/diagnostic-agent.dpkg-new/ wr,
  /etc/intel-manageability/public/dispatcher-agent/ w,
  /etc/intel-manageability/public/dispatcher-agent/* l,
  /etc/intel-manageability/public/dispatcher-agent/* rw,
  /etc/intel-manageability/public/dispatcher-agent/logging.ini wr,
  /etc/intel-manageability/public/dispatcher-agent.dpkg-new/ wr,
  /etc/intel-manageability/public/cloudadapter-agent/ w,
  /etc/intel-manageability/public/cloudadapter-agent/* rw,
  /etc/intel-manageability/public/cloudadapter-agent.dpkg-new/ wr,
  /var/movisoc-fwu-status rw,
  /var/lib/dispatcher/ rw,
  /var/lib/dispatcher/** rw,
  /var/lib/dispatcher/upload/ rw,
  /var/lib/dispatcher/upload/** rw,
  /var/lib/dispatcher/upload/upgrade.log rw,
  /var/lib/dpkg/ r,
  /var/lib/dpkg/* l,
  /var/lib/dpkg/* wr,
  /var/lib/dpkg/info/ r,
  /var/lib/dpkg/info/* rwix,
  /var/lib/dpkg/lock k,
  /var/lib/dpkg/lock-frontend k,
  /var/lib/dpkg/tmp.ci/ rw,
  /var/lib/dpkg/tmp.ci/** rwix,
  /var/lib/dpkg/tmp.ci/preinst rix,
  /var/lib/dpkg/triggers/* rw,
  /var/lib/dpkg/triggers/Lock k,
  /var/lib/dpkg/updates/ rw,
  /var/lib/dpkg/updates/* rw,
  /var/local/intel-manageability/backups/version.txt r,
  /var/local/intel-manageability/backups/** w,
  /var/log/dpkg.log w,
  /etc/intel-manageability/public/telemetry-agent/ w,
  /etc/intel-manageability/public/telemetry-agent/* l,
  /etc/intel-manageability/public/telemetry-agent/* rw,
  /etc/intel-manageability/public/telemetry-agent.dpkg-new/ wr,
  /etc/force_yocto r,
  /usr/bin/mender rUx,
  /etc/mender/scripts/ArtifactInstall_Leave_00_relabel_ext4 rUx,
  /etc/mender/artifact_info r,
  /etc/ssl/openssl.cnf r,
  /usr/share/intel/managed/artifact_info r,
  /scripts/dmi_id_bios_info/* r,
  /usr/share/misc/magic.mgc r,
  /usr/bin/file rix,
  /usr/bin/file.file rix,
  /usr/sbin/chroot rUx,
  /usr/** r,
  /usr/bin/fwupdate rUx
}
