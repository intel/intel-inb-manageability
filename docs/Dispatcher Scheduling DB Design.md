---
linktitle: "Dispatcher Schedule DB ER-Design"
categories: ["Design"]
status: "approved"
weight: 2
toc_hide: false
hide_summary: false
description: >
  ER Model for Database used to schedule tasks in Dispatcher service of Intel Inband Manageability
---

# Dispatcher Schedule Database Design

## Overview

The database to be used will be SQLite3.  The database will be used to keep track of scheduled tasks as either a single task at a specified time or a repeated task set up as a cron job.  

The goal of this design is to have a database design that adheres to the principles of Normal Form.

## ER Model

```mermaid
---

title: Dispatcher Schedule ER Model

---

erDiagram
    SINGLE_SCHEDULE ||--o{ SINGLE_SCHEDULE_MANIFEST : schedules
    SINGLE_SCHEDULE_MANIFEST {
        INTEGER priority "Order the manifests should run"
        INTEGER schedule_id PK, FK "REFERENCES single_schedule(id)"
        INTEGER manifest_id PK, FK "REFERENCES manifest(id)"
    }

    SINGLE_SCHEDULE {
        INTEGER id PK "AUTOINCREMENT"
        TEXT request_id "NOT NULL - Format -> 2024-01-01T00:00:00"
        TEXT start_time "NOT NULL - Format -> 2024-01-01T00:00:00"
        TEXT end_time
    }
    MANIFEST ||--o{ SINGLE_SCHEDULE_MANIFEST : performs
    MANIFEST ||--o{ REPEATED_SCHEDULE_MANIFEST : performs

    MANIFEST {
        INTEGER id PK "AUTOINCREMENT"
        TEXT manifest "NOT NULL"
    }
    REPEATED_SCHEDULE ||--o{ REPEATED_SCHEDULE_MANIFEST : schedules
    REPEATED_SCHEDULE_MANIFEST {
        INTEGER priority "Order the manifests should run"
        INTEGER schedule_id PK, FK "REFERENCES repeated_schedule(id)"
        INTEGER manifest_id PK, FK "REFERENCES manifest(id)"
    }

    REPEATED_SCHEDULE {
        INTEGER id PK "AUTOINCREMENT"
        TEXT request_id "NOT NULL"
        TEXT cron_duration "NOT NULL"
        TEXT cron_minutes "NOT NULL"
        TEXT cron_hours "NOT NULL"
        TEXT cron_day_month "NOT NULL"
        TEXT cron_month "NOT NULL"
        TEXT cron_day_week "NOT NULL"
    }
    
```

## DB Table Examples

### MANIFEST Table

| id | manifest |
| :---- | :----- |
| 1 | valid Inband Manageability XML manifest - SOTA download only |
| 2 | valid Inband Manageability XML manifest - SOTA install only|
| 3 | valid Inband Manageability XML manifest - Reboot system |

### SINGLE_SCHEDULE Table

| id | request_id | start_time | end_time |
| :---- | :---- | :---- | :---- |
| 1  | 123 | 2023-04-01T08:00:00 | |
| 2  | 123 | 2023-05-01T08:00:00 | |
| 3  | 234 | 2023-04-01T08:00:00 | |

### REPEATED_SCHEDULE Table

NOTE: These values may not make sense in the real world.  Just for demonstration purposes.

| id | request_id | cron_duration | cron_minutes | cron_hours | cron_day_month | cron_month |cron_day_week |
| :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| 1 | 123 | P1D | 0 | */3 | * | * | * |
| 2 | 123 | P7D | 0 | */6 | * | * | * |
| 3 | 234 | P2D | 0 | */8 | * | * | * |
| 4 | 234 | P14D | 0 | * | * | * | * |

### SINGLE_SCHEDULE_MANIFEST Table

Example: To do a download, install, and reboot of SOTA at the time in schedule 1

| priority | schedule_id | manifest_id |
| :---- | :---- | :---- |
| 0   | 1 | 1 |
| 1   | 1 | 2 |
| 2   | 1 | 3 |

### REPEATED_SCHEDULE_MANIFEST Table

Example: To do a download, install, and reboot of SOTA at the repeated time in schedule 2

| priority | schedule_id | manifest_id |
| :---- | :---- | :---- |
| 0   | 2 | 1 |
| 1   | 2 | 2 |
| 2   | 2 | 3 |

## Field Descriptions

| Name  | Description | Required? |
| :--- | :--- | :---|
| id    | Auto-generated by DB.  The request Ids will not be unique in the tables to use as a PK. | Yes |
| request_id | Request ID generated by MJunct that is used to trace the request.| Yes |
| start_time | starting date/time for a single scheduled request.| Yes |
| end_time | ending date/time for a single scheduled request. | No |
| cron_duration |  period between successive executions of a scheduled task defined by a cron job | Yes |
| cron_minutes | field in a cron job schedule that specifies the minute of the hour at which the task should run, ranging from 0 to 59  | Yes |
| cron_hours | field in a cron job schedule that specifies the hour of the day at which the task should execute, using a 24-hour format ranging from 0 to 23 | Yes |
| cron_day_month | field in a cron job schedule that specifies the day of the month on which the task should run, ranging from 1 to 31.   | Yes  |
| cron_month |  field in a cron job schedule that specifies the month during which the task should execute, ranging from 1 (January) to 12 (December).   | Yes |
| cron_day_week | field in a cron job schedule that specifies the day of the week on which the task should run, ranging from 0 (Sunday) to 6 (Saturday).     | Yes |
